# Production Environment Configuration
# Environment-specific settings for production deployments

environment:
  name: production
  description: Production environment for live deployments
  type: production

# Cloud provider configurations
cloud:
  provider: aws
  region: us-east-1
  account_id: "123456789012"

  # AWS-specific settings
  aws:
    # S3 buckets
    s3_buckets:
      artifacts: "production-artifacts-bucket"
      logs: "production-logs-bucket"
      backups: "production-backups-bucket"
      static_assets: "production-static-bucket"

    # DynamoDB tables
    dynamodb_tables:
      users: "production-users-table"
      sessions: "production-sessions-table"
      audit_logs: "production-audit-table"
      metrics: "production-metrics-table"

    # VPC configuration
    vpc:
      cidr: "10.0.0.0/16"
      subnets:
        - "10.0.0.0/24"  # Public
        - "10.0.1.0/24" # Private
        - "10.0.2.0/24" # Database
        - "10.0.3.0/24" # Reserved

    # Security groups
    security_groups:
      - "production-web-sg"
      - "production-db-sg"
      - "production-cache-sg"
      - "production-lb-sg"

    # Route 53 configuration
    route53:
      hosted_zone: "example.com"
      record_name: "api"
      ttl: 300

# Application configuration
application:
  name: "ci-excellence-app"
  version: "${VERSION:-latest}"

  # Environment variables
  environment_variables:
    NODE_ENV: "production"
    LOG_LEVEL: "warn"
    API_BASE_URL: "https://api.example.com"
    WEB_BASE_URL: "https://example.com"

    # Database configuration
    DATABASE_HOST: "${PRODUCTION_DATABASE_HOST}"
    DATABASE_PORT: "5432"
    DATABASE_NAME: "production_db"
    DATABASE_SSL_MODE: "require"

    # Redis configuration
    REDIS_HOST: "${PRODUCTION_REDIS_HOST}"
    REDIS_PORT: "6379"
    REDIS_DB: "0"
    REDIS_SSL_ENABLED: "true"

    # Security
    JWT_SECRET: "${PRODUCTION_JWT_SECRET}"
    ENCRYPTION_KEY: "${PRODUCTION_ENCRYPTION_KEY}"
    COOKIE_SECRET: "${PRODUCTION_COOKIE_SECRET}"

    # External services
    PAYMENT_PROVIDER: "stripe_production"
    EMAIL_PROVIDER: "sendgrid_production"
    ANALYTICS_PROVIDER: "google_analytics"
    MONITORING_PROVIDER: "datadog_production"

    # Performance optimization
    ENABLE_COMPRESSION: "true"
    ENABLE_CACHING: "true"
    CACHE_TTL: "3600"

# Service configuration
services:
  web:
    replicas: 3
    cpu_limit: "1000m"
    memory_limit: "1Gi"
    image: "nginx:1.21-alpine"
    port: 443
    health_check:
      path: "/health"
      interval: 15
      timeout: 5
      retries: 3
      success_threshold: 2

  api:
    replicas: 4
    cpu_limit: "2000m"
    memory_limit: "2Gi"
    image: "${API_IMAGE:-ci-excellence-api:production}"
    port: 3000
    health_check:
      path: "/api/health"
      interval: 15
      timeout: 10
      retries: 3
      success_threshold: 2

  worker:
    replicas: 2
    cpu_limit: "1000m"
    memory_limit: "1Gi"
    image: "${WORKER_IMAGE:-ci-excellence-worker:production}"

  database:
    engine: "postgresql"
    version: "14"
    instance_class: "db.r6g.large"
    storage_gb: 500
    backup_retention: 30
    multi_az: true
    enhanced_monitoring: true

  cache:
    engine: "redis"
    version: "6.2"
    node_type: "cache.r6g.large"
    cluster_mode: false
    automatic_failover: true
    multi_az: true

  monitoring:
    enabled: true
    tools:
      - prometheus
      - grafana
      - jaeger
      - loki
      - datadog

# Feature flags
feature_flags:
  new_ui: true
  advanced_search: true
  beta_features: false
  debug_mode: false
  performance_mode: true
  analytics_tracking: true

# Scaling configuration
scaling:
  auto_scaling:
    min_replicas: 3
    max_replicas: 20
    target_cpu_utilization: 60
    target_memory_utilization: 70

  schedule_scaling:
    - name: "peak_hours"
      min_replicas: 6
      max_replicas: 15
      timezone: "America/New_York"
      schedule: "0 9 * * 1-5"  # 9 AM weekdays
    - name: "peak_hours_end"
      min_replicas: 3
      max_replicas: 10
      timezone: "America/New_York"
      schedule: "0 18 * * 1-5"  # 6 PM weekdays
    - name: "weekend_scale"
      min_replicas: 2
      max_replicas: 5
      timezone: "America/New_York"
      schedule: "0 0 * * 6,0"  # Midnight weekends

  predictive_scaling:
    enabled: true
    lookback_days: 14
    scale_in_cooldown: 300
    scale_out_cooldown: 60

# Monitoring and alerting
monitoring:
  alerting:
    enabled: true
    channels:
      - type: "email"
        recipients: ["production-alerts@example.com"]
      - type: "slack"
        webhook_url: "${PRODUCTION_SLACK_WEBHOOK}"
        channel: "#production-alerts"
      - type: "pagerduty"
        service_key: "${PAGERDUTY_SERVICE_KEY}"
        urgency: "high"

  metrics:
    collection_interval: 30
    retention_days: 90
    detailed_metrics: true

  logging:
    level: "warn"
    format: "json"
    destination: "cloudwatch"
    structured_logging: true

  custom_dashboards:
    - "application-performance"
    - "business-metrics"
    - "infrastructure-health"
    - "security-events"

# Security settings
security:
  authentication:
    enabled: true
    method: "jwt"
    token_expiry: "1h"
    refresh_token_expiry: "7d"

  authorization:
    rbac_enabled: true
    default_role: "viewer"
    admin_roles: ["admin", "superadmin"]

  network:
    ssl_enabled: true
    ssl_cert_arn: "${PRODUCTION_SSL_CERT_ARN}"
    force_ssl_redirect: true
    hsts_enabled: true
    hsts_max_age: 31536000

  compliance:
    encryption_at_rest: true
    encryption_in_transit: true
    audit_logging: true
    data_retention: true
    gdpr_compliance: true

  waf:
    enabled: true
    rules:
      - "SQL Injection Protection"
      - "XSS Protection"
      - "Rate Limiting"
      - "IP Blacklisting"

  access_control:
    ip_whitelist: true
    geo_blocking: false
    rate_limiting:
      requests_per_minute: 1000
      burst_limit: 2000

# Deployment configuration
deployment:
  strategy: "blue_green"
  max_unavailable: 0
  max_surge: 100

  health_check_grace_period: 120
  termination_grace_period: 60

  # Production-specific deployment settings
  environment_validation: true
  smoke_tests: true
  rollback_on_failure: true
  rollback_health_check: true

  deployment_gates:
    - name: "security_scan"
      enabled: true
      threshold: 0
    - name: "performance_test"
      enabled: true
      threshold: 95
    - name: "functional_test"
      enabled: true
      threshold: 100

# Data management
data:
  backups:
    enabled: true
    frequency: "hourly"
    retention_days: 30
    cross_region: true
    encryption: true

  point_in_time_recovery:
    enabled: true
    retention_days: 7

  migrations:
    auto_apply: false
    require_approval: true
    rollback_enabled: true

  replication:
    read_replicas: 2
    cross_region_replication: true
    disaster_recovery: true

  archive:
    enabled: true
    cold_storage: "glacier"
    archive_after_days: 90
    retention_years: 7

# Integration endpoints
integrations:
  external_apis:
    - name: "payment_service"
      base_url: "https://api.stripe.com/v1"
      timeout: 30
      retry_count: 3
      circuit_breaker: true

    - name: "email_service"
      base_url: "https://api.sendgrid.com/v3"
      timeout: 15
      retry_count: 2
      circuit_breaker: true

    - name: "analytics_service"
      base_url: "https://api.google-analytics.com/v4"
      timeout: 10
      retry_count: 1

  webhooks:
    - name: "deployment_notifications"
      url: "${DEPLOYMENT_WEBHOOK_URL}"
      events: ["deploy_start", "deploy_success", "deploy_failure", "rollback"]
      retry_count: 3

    - name: "security_alerts"
      url: "${SECURITY_WEBHOOK_URL}"
      events: ["security_incident", "authentication_failure", "access_denied"]

# Resource quotas
quotas:
  cpu: "8000m"
  memory: "16Gi"
  storage: "1Ti"
  bandwidth: "1TB/month"
  requests_per_minute: 10000

# Compliance and auditing
compliance:
  audit_logging:
    enabled: true
    log_all_api_calls: true
    log_data_access: true
    retention_years: 7

  data_protection:
    anonymization: true
    pseudonymization: true
    data_minimization: true

  regulatory:
    gdpr: true
    hipaa: false
    sox: true
    pci_dss: true

# Performance optimization
performance:
  cdn:
    enabled: true
    provider: "cloudflare"
    cache_ttl: 3600

  compression:
    enabled: true
    types: ["gzip", "brotli"]

  caching:
    browser_cache: true
    edge_cache: true
    database_cache: true
    redis_cache: true

  optimization:
    image_optimization: true
    asset_bundling: true
    code_splitting: true

# Disaster recovery
disaster_recovery:
  rto: "15m"  # Recovery Time Objective
  rpo: "1h"   # Recovery Point Objective
  backup_frequency: "hourly"
  cross_region_recovery: true

  failover:
    automatic: true
    health_check_interval: 30
    failover_timeout: 300

  testing:
    quarterly_drills: true
    chaos_engineering: false